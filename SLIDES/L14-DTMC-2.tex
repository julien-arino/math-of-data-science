\documentclass[aspectratio=169]{beamer}\usepackage[]{graphicx}\usepackage[]{xcolor}
% maxwidth is the original width if it is less than linewidth
% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlsng}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hldef}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}

% Set lecture number for later use


% Part common to all the lectures
\subtitle{MATH 2740 -- Mathematics of Data Science -- Lecture 25}
\author{\texorpdfstring{Julien Arino\newline\url{julien.arino@umanitoba.ca}}{Julien Arino}}
\institute{Department of Mathematics @ University of Manitoba}
\date{Fall 202X}

% Title of the lecture
\title{Absorbing Markov chains}



\input{slides-setup-whiteBG.tex}



\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% TITLE AND OUTLINE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\titlepagewithfigure{FIGS-slides-admin/Gemini_Generated_Image_ssozssssozssssoz.jpeg}
\outlinepage{FIGS-slides-admin/Gemini_Generated_Image_2dtfd12dtfd12dtf.jpeg}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Absorbing Markov chains}
\newSectionSlide{FIGS-slides-admin/Gemini_Generated_Image_dzsfcndzsfcndzsf.jpeg}

\begin{frame}{Changing the setting of the genetic experiment}
Suppose now the same type of experiment, but mate each new generation with a GG individual instead of a Gg individual
\vfill
\begin{center}
\begin{tikzpicture}
	[inner sep=2mm,
	place/.style={circle,draw=blue!50,fill=blue!90,thick,minimum size=1.25cm}]
	\node [place] (GG) {GG};
	\node [place] (Gg) [right=of GG] {Gg};
	\node [place] (gg) [right=of Gg]{gg};
	\draw[->] (GG) to [loop above] node [auto] {1} (GG);
	\draw[->] (Gg) to node [auto] {0.5} (GG);
	\draw[->] (Gg) to [loop above] node [auto] {0.5} (Gg);
	\draw[->] (gg) to node [auto] {1} (Gg);
\end{tikzpicture}
\end{center}
\vfill
\begin{minipage}{0.45\textwidth}
	\begin{center}
		\begin{tabular}{c|ccc}
		$\swarrow$ & GG & Gg & gg \\
		\hline
		GG & 1 & 0.5 & 0 \\
		Gg & 0 & 0.5 & 1 \\
		gg & 0 & 0 & 0
		\end{tabular}
	\end{center}
\end{minipage}
\begin{minipage}{0.45\textwidth}
	\[
		P=\begin{pmatrix}
		1 & 1/2 & 0 \\[5pt]
		0 & 1/2 & 1 \\[5pt]
		0 & 0 & 0
		\end{pmatrix}
	\]
\end{minipage}
\begin{itemize}
\item leave gg after 1 iteration and can never return
\item when we leave Gg, we can never return
\item we can never leave GG when we get there
\end{itemize}
\end{frame}


\begin{frame}{Absorbing Markov chains}
\begin{definition}[Absorbing state]
A state $S_i$ in a Markov chain is \textbf{absorbing} if whenever it occurs on the $t^{th}$ generation of the experiment, it then occurs on every subsequent step. In other words, $S_i$ is absorbing if $p_{ii}=1$ and $p_{ij}=0$ for $i\neq j$
\end{definition}
\vfill
\begin{definition}[Absorbing chain]
A Markov chain is \textbf{absorbing} if it has at least one absorbing state, and if from every state it is possible to go to an absorbing state.
In an absorbing Markov chain, a state that is not absorbing is called \textbf{transient}
\end{definition}
\end{frame}


\begin{frame}
%\begin{figure}[htbp]
%\centering
%\includegraphics[width=0.4\textwidth]{FIGS/graphe_absorbant}
%\caption{Example of a graph corresponding to an absorbing Markov chain. States 1 and 4 are absorbing, states 2 and 3 are transient.}
%\label{fig:genetics_absorbing_graph}
%\end{figure}
Suppose we have a chain like the following
\begin{center}
\begin{tikzpicture}
	[inner sep=2mm,
	place/.style={circle,draw=blue!50,fill=blue!90,thick,minimum size=1cm}]
	\node [place] (1) {1};
	\node [place] (2) [right=of 1] {2};
	\node [place] (3) [right=of 2] {3};
	\node [place] (4) [right=of 3] {4};
	\draw[->] (1) to [loop above] (1);
	\draw[->] (2) to [loop above] (2);
	\draw[->] (3) to [loop above] (3);
	\draw[->] (4) to [loop above] (4);
	\draw[->] (2) to (1);
	\draw[->] (2) to [bend left] (3);
	\draw[->] (3) to [bend left] (2);
	\draw[->] (3) to (4);
\end{tikzpicture}
\end{center}
\vfill
\begin{enumerate}
\item Does the process eventually reach an absorbing state?
\item What is the average number of steps spent in a transient state, if starting in a transient state?
\item What is the average number of steps before entering an absorbing state?
\item What is the probability of being absorbed by a given absorbing state, when there are more than one, when starting in a given transient state?
\end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Analysing absorbing Markov chains}
\newSectionSlide{FIGS-slides-admin/Gemini_Generated_Image_dzsfcndzsfcndzsf.jpeg}

\begin{frame}
The answer to the first question (``Does the process eventually reach an absorbing state?'') is given by the following result
\vfill
\begin{theorem}
In an absorbing Markov chain, the probability of reaching an absorbing state is 1
\end{theorem}
\end{frame}

\begin{frame}
To answer the other questions, write the transition matrix in \textbf{standard} form
\vfill
For an absorbing chain with $k$ absorbing states and $r-k$ transient states, write transition matrix as
\[
P=\begin{pmatrix}
\mathbb{I}_k & R \\
\b0 & Q
\end{pmatrix}
\]
with following meaning
\begin{center}\footnotesize
\begin{tabular}{ccc}
& Absorbing states & Transient states \\
Absorbing states & $\mathbb{I}_k$ & $R$ \\
Transient states & $\b0$ & $Q$
\end{tabular}
\end{center}
with $\mathbb{I}_k$ the $k\times k$ identity matrix, $\mathbf{0}$ an $(r-k)\times k$ matrix of zeros, $R$ an $k\times (r-k)$ matrix and $Q$ an $(r-k)\times(r-k)$ matrix.
The matrix $\mathbb{I}_{r-k}-Q$ is invertible. Let
\begin{itemize}
\item $N=(\mathbb{I}_{r-k}-Q)^{-1}$ the \textbf{fundamental matrix} of the MC
\item $T_i$ sum of the entries on row $i$ of $N$
\item $B=RN$
\end{itemize}
\end{frame}

\begin{frame}
Answers to our remaining questions:
\vfill
\begin{enumerate}
\setcounter{enumi}{1}
\item $N_{ij}$ average number of times the process is in the $j$th transient state if it starts in the $i$th transient state
\vfill
\item $T_i$ average number of steps before the process enters an absorbing state if it starts in the $i$th transient state
\vfill
\item $B_{ij}$ probability of eventually entering the $i$th absorbing state if the process starts in the $j$th transient state
\end{enumerate}
\vfill
\end{frame}

\begin{frame}{Back to the genetic example}
The matrix is already in standard form
\[
P=
\begin{pmatrix}
1 & \frac 12 & 0 \\
0 & \frac 12 & 1 \\
0 & 0 & 0
\end{pmatrix}
=\begin{pmatrix}
\mathbb{I}_1 & R \\
\b0 & Q
\end{pmatrix}
\]
with $\mathbb{I}_1=1$, $\mathbf{0}=(0\;\; 0)^T$ and
\[
R=\begin{pmatrix}
\frac 12 & 0
\end{pmatrix}
\qquad
Q=\begin{pmatrix}
\frac 12 & 1\\
0 & 0
\end{pmatrix}
\]
We have
\[
\mathbb{I}_2-Q=\begin{pmatrix}
1 & 0 \\
0 & 1
\end{pmatrix}
-\begin{pmatrix}
\frac 12 & 1\\
0 & 0
\end{pmatrix}
=\begin{pmatrix}
\frac 12 & -1\\
0 & 1
\end{pmatrix}
\]
so
\[
N=(\mathbb{I}_2-Q)^{-1}=
2\begin{pmatrix}
1 & 1 \\
0 & \frac 12
\end{pmatrix}=
\begin{pmatrix}
2 & 0 \\
2 & 1
\end{pmatrix}
\]
\end{frame}


\begin{frame}
We have
\[
N=
\begin{pmatrix}
	2 & 0 \\
	2 & 1
\end{pmatrix}
\]
So
\[
T=N\nbOne=\begin{pmatrix}
2\\
3
\end{pmatrix}
\]
and
\[
B=RN=
\begin{pmatrix}
	\frac 12 & 0
\end{pmatrix}
\begin{pmatrix}
	2 & 0 \\
	2 & 1
\end{pmatrix}
=
\begin{pmatrix}
1 & 1
\end{pmatrix}
\]
\end{frame}


\begin{frame}
\begin{enumerate}
\setcounter{enumi}{1}
\item $N_{ij}$ average number of times the process is in the $j$th transient state if it starts in the $i$th transient state
\[
N=
\begin{pmatrix}
2 & 0 \\
2 & 1
\end{pmatrix}
\]
\vfill
\item $T_i$ average number of steps before the process enters an absorbing state if it starts in the $i$th transient state
\[
T=\begin{pmatrix}
2\\
3
\end{pmatrix}
\]
\vfill
\item $B_{ij}$ probability of eventually entering the $i$th absorbing state if the process starts in the $j$th transient state
\[
B=
\begin{pmatrix}
	1 & 1
\end{pmatrix}
\]
\end{enumerate}
\vfill
\end{frame}

\begin{frame}[fragile]\frametitle{Make an absorbing random walk}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# Total population}
\hldef{nb_states} \hlkwb{=} \hlnum{7}
\hldef{proba_left} \hlkwb{=} \hlnum{0.5}  \hlcom{# Probability of moving left}
\hldef{proba_right} \hlkwb{=} \hlnum{0.5} \hlcom{# Probability of moving right}
\hldef{proba_stay} \hlkwb{=} \hlnum{1}\hlopt{-}\hldef{(proba_left}\hlopt{+}\hldef{proba_right)}
\hlcom{# Make the transition matrix}
\hldef{T} \hlkwb{=} \hlkwd{mat.or.vec}\hldef{(}\hlkwc{nr} \hldef{= nb_states,} \hlkwc{nc} \hldef{= nb_states)}
\hlkwa{for} \hldef{(row} \hlkwa{in} \hlnum{2}\hlopt{:}\hldef{(nb_states}\hlopt{-}\hlnum{1}\hldef{)) \{}
  \hldef{T[row,(row}\hlopt{-}\hlnum{1}\hldef{)]} \hlkwb{=} \hldef{proba_left}
  \hldef{T[row,(row}\hlopt{+}\hlnum{1}\hldef{)]} \hlkwb{=} \hldef{proba_right}
  \hldef{T[row, row]} \hlkwb{=} \hldef{proba_stay}
\hldef{\}}
\hldef{T[}\hlnum{1}\hldef{,}\hlnum{1}\hldef{]} \hlkwb{=} \hlnum{1} \hlcom{# First state is absorbing}
\hldef{T[nb_states, nb_states]} \hlkwb{=} \hlnum{1} \hlcom{# Last too}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]\frametitle{Create MC object}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{mcRW} \hlkwb{<-} \hlkwd{new}\hldef{(}\hlsng{"markovchain"}\hldef{,}
            \hlkwc{states} \hldef{=} \hlkwd{sprintf}\hldef{(}\hlsng{"S_%d"}\hldef{,} \hlnum{1}\hlopt{:}\hldef{nb_states),}
            \hlkwc{transitionMatrix} \hldef{= T,}
            \hlkwc{name} \hldef{=} \hlsng{"RW_abs"}\hldef{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]\frametitle{Show some info about the chain}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{summary}\hldef{(mcRW)}
\end{alltt}
\begin{verbatim}
## RW_abs  Markov chain that is composed by: 
## Closed classes: 
## S_1 
## S_7 
## Recurrent classes: 
## {S_1},{S_7}
## Transient classes: 
## {S_2,S_3,S_4,S_5,S_6}
## The Markov chain is not irreducible 
## The absorbing states are: S_1 S_7
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]\frametitle{Plotting the chain}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hldef{(mcRW)}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}

\maxFrameImage{FIGS/L25-DTMC-random-walk-absorbing-1.pdf}

\begin{frame}[fragile]\frametitle{Showing a realisation}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# Library: DTMCPack}
\hldef{IC} \hlkwb{=} \hlkwd{rep}\hldef{(}\hlnum{0}\hldef{, nb_states)}
\hldef{IC[}\hlnum{4}\hldef{]} \hlkwb{=} \hlnum{1}
\hldef{sol} \hlkwb{=} \hlkwd{DTMC}\hldef{(T, IC,} \hlnum{30}\hldef{,} \hlkwc{trace}\hldef{=}\hlnum{TRUE}\hldef{)}
\end{alltt}
\begin{verbatim}
## NULL
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\maxFrameImage{FIGS/L25-DTMC-random-walk-absorbing-realisation-1.pdf}

\begin{frame}\frametitle{Additional information about absorbing chains}
\code{canonicForm(mcRW)}
\vfill
\code{meanAbsorptionTime(mcRW)}
\vfill
\code{absorptionProbabilities(mcRW)}
\vfill
\code{hittingProbabilities(mcRW)}
\end{frame}

\begin{frame}[fragile]\frametitle{Canonical form}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{canonicForm}\hldef{(mcRW)}
\end{alltt}
\begin{verbatim}
## RW_abs 
##  A  7 - dimensional discrete Markov Chain defined by the following states: 
##  S_1, S_7, S_2, S_3, S_4, S_5, S_6 
##  The transition matrix  (by rows)  is defined as follows: 
##     S_1 S_7 S_2 S_3 S_4 S_5 S_6
## S_1 1.0 0.0 0.0 0.0 0.0 0.0 0.0
## S_7 0.0 1.0 0.0 0.0 0.0 0.0 0.0
## S_2 0.5 0.0 0.0 0.5 0.0 0.0 0.0
## S_3 0.0 0.0 0.5 0.0 0.5 0.0 0.0
## S_4 0.0 0.0 0.0 0.5 0.0 0.5 0.0
## S_5 0.0 0.0 0.0 0.0 0.5 0.0 0.5
## S_6 0.0 0.5 0.0 0.0 0.0 0.5 0.0
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]\frametitle{Mean absorption time}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{meanAbsorptionTime}\hldef{(mcRW)}
\end{alltt}
\begin{verbatim}
## S_2 S_3 S_4 S_5 S_6 
##   5   8   9   8   5
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]\frametitle{Absorption probabilities}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{absorptionProbabilities}\hldef{(mcRW)}
\end{alltt}
\begin{verbatim}
##           S_1       S_7
## S_2 0.8333333 0.1666667
## S_3 0.6666667 0.3333333
## S_4 0.5000000 0.5000000
## S_5 0.3333333 0.6666667
## S_6 0.1666667 0.8333333
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]\frametitle{Hitting probabilities}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{hittingProbabilities}\hldef{(mcRW)}
\end{alltt}
\begin{verbatim}
##           S_1 S_2   S_3       S_4   S_5 S_6       S_7
## S_1 1.0000000 0.0 0.000 0.0000000 0.000 0.0 0.0000000
## S_2 0.8333333 0.4 0.500 0.3333333 0.250 0.2 0.1666667
## S_3 0.6666667 0.8 0.625 0.6666667 0.500 0.4 0.3333333
## S_4 0.5000000 0.6 0.750 0.6666667 0.750 0.6 0.5000000
## S_5 0.3333333 0.4 0.500 0.6666667 0.625 0.8 0.6666667
## S_6 0.1666667 0.2 0.250 0.3333333 0.500 0.4 0.8333333
## S_7 0.0000000 0.0 0.000 0.0000000 0.000 0.0 1.0000000
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{A few examples}
\newSectionSlide{FIGS-slides-admin/Gemini_Generated_Image_dzsfcndzsfcndzsf.jpeg}




\end{document}
