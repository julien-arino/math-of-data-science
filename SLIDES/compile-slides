#!/bin/bash

# Render the lectures and copy them where they need 
# to be (/docs in the repo)
# Do a local render (might not be most recent version
# of marp)
# Does pull and push, so beware..

# First, copy the corresponding Rnw files from the new content directory
for f in L??-*.Rnw
do
  if [ -f ~/github/math-of-data-science-new-content/SLIDES/"$f" ]; then
    echo "Copying $f from new content directory..."
    cp ~/github/math-of-data-science-new-content/SLIDES/"$f" .
  fi
done

for f in L??-*.Rnw
do
  Rscript -e "library(knitr); knit('$f')"
done

for f in L??-*.tex 
do
    # We need to run pdflatex three times to get cross-references and TOC right
    pdflatex -interaction=nonstopmode $f
    pdflatex -interaction=nonstopmode $f
    pdflatex -interaction=nonstopmode $f
done

# Clean up auxiliary files
find . -maxdepth 1 \( -name "*.aux" -o -name "*-concordance.tex" -o -name "*.fdb_latexmk" -o -name "*.fls" -o -name "*.idx" -o -name "*.ilg" -o -name "*.ind" -o -name "*.log" -o -name "*.nav" -o -name "*.out" -o -name "*.snm" -o -name "*.synctex.gz" -o -name "*.toc" -o -name "*.vrb" \) -delete
