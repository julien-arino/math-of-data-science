\documentclass[aspectratio=169]{beamer}

% Set lecture number for later use


% Part common to all the lectures
\subtitle{MATH 2740 -- Mathematics of Data Science -- Lecture 05}
\author{\texorpdfstring{Julien Arino\newline\url{julien.arino@umanitoba.ca}}{Julien Arino}}
\institute{Department of Mathematics @ University of Manitoba}
\date{Fall 202X}

% Title of the lecture
\title{Matrix methods -- Least squares problems}



\input{slides-setup-whiteBG.tex}

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% TITLE AND OUTLINE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\titlepagewithfigure{FIGS-slides-admin/Gemini_Generated_Image_7iz9ft7iz9ft7iz9.jpeg}
\outlinepage{FIGS-slides-admin/Gemini_Generated_Image_iyzqdwiyzqdwiyzq.jpeg}


%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\Ssection{Least squares problems}{FIGS-slides-admin/Gemini_Generated_Image_c06eixc06eixc06e.jpeg}


%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\Ssubsection{Getting the Canadian census data}{FIGS-slides-admin/Gemini_Generated_Image_5srris5srris5srr.jpeg}

\begin{frame}\frametitle{Grabing the Canadian census data}
We want to consider the evolution of the population of Canada through time
\vfill
For this, we grab the Canadian census data
\vfill Search for (Google) ``Canada historical census data csv", since csv (comma separated values) is a very easy format to use with R
\vfill
Here, we find a csv for 1851 to 1976
\vfill
We follow the link to Table A2-14, where we find another link, this time to a csv file. This is what we use in \code{R}
\end{frame}


\begin{frame}[fragile]\frametitle{Grabing the Canadian census data}
The function \code{read.csv} reads in a file (potentially directly from the web)
\vfill
Assign the result to the variable data. We then use the function head to show the first few lines in the result.
\vfill
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{data_old} \hlkwb{=} \hlkwd{read.csv}\hldef{(}\hlsng{"https://www150.statcan.gc.ca/n1/en/pub/11-516-x/sectiona/A2_14-eng.csv?st=L7vSnqio"}\hldef{)}
\hlkwd{head}\hldef{(data_old)}
\end{alltt}
\begin{verbatim}
##    X Series.A2.14.
## 1 NA              
## 2 NA          Year
## 3 NA              
## 4 NA              
## 5 NA              
## 6 NA              
##   Population.of.Canada..by.province..census.dates..1851.to.1976 X.1       X.2
## 1                                                                NA          
## 2                                                        Canada  NA Newfound-
## 3                                                                NA      land
## 4                                                                NA          
## 5                                                             2  NA         3
## 6                                                                NA          
##      X.3 X.4    X.5       X.6    X.7     X.8       X.9 X.10    X.11 X.12
## 1         NA                                             NA           NA
## 2 Prince  NA   Nova       New Quebec Ontario  Manitoba   NA Saskat-   NA
## 3 Edward  NA Scotia Brunswick                            NA  chewan   NA
## 4 Island  NA                                             NA           NA
## 5      4  NA      5         6      7       8         9   NA      10   NA
## 6         NA                                             NA           NA
##      X.13 X.14     X.15 X.16      X.17        X.18 X.19 X.20
## 1           NA            NA                         NA   NA
## 2 Alberta   NA  British   NA     Yukon   Northwest   NA   NA
## 3           NA Columbia   NA Territory Territories   NA   NA
## 4           NA            NA                         NA   NA
## 5      11   NA       12   NA        13          14   NA   NA
## 6           NA            NA                         NA   NA
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
Obviously, this does not make a lot of sense. This is normal: take a look at the first few lines in the file. They take the form
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{head}\hldef{(data_old)}
\end{alltt}
\begin{verbatim}
##    X Series.A2.14.
## 1 NA              
## 2 NA          Year
## 3 NA              
## 4 NA              
## 5 NA              
## 6 NA              
##   Population.of.Canada..by.province..census.dates..1851.to.1976 X.1       X.2
## 1                                                                NA          
## 2                                                        Canada  NA Newfound-
## 3                                                                NA      land
## 4                                                                NA          
## 5                                                             2  NA         3
## 6                                                                NA          
##      X.3 X.4    X.5       X.6    X.7     X.8       X.9 X.10    X.11 X.12
## 1         NA                                             NA           NA
## 2 Prince  NA   Nova       New Quebec Ontario  Manitoba   NA Saskat-   NA
## 3 Edward  NA Scotia Brunswick                            NA  chewan   NA
## 4 Island  NA                                             NA           NA
## 5      4  NA      5         6      7       8         9   NA      10   NA
## 6         NA                                             NA           NA
##      X.13 X.14     X.15 X.16      X.17        X.18 X.19 X.20
## 1           NA            NA                         NA   NA
## 2 Alberta   NA  British   NA     Yukon   Northwest   NA   NA
## 3           NA Columbia   NA Territory Territories   NA   NA
## 4           NA            NA                         NA   NA
## 5      11   NA       12   NA        13          14   NA   NA
## 6           NA            NA                         NA   NA
\end{verbatim}
\end{kframe}
\end{knitrout}
\vfill
This happens often: the first few lines are here to set the information, they lay out a simple version of the so-called metadata
\end{frame}

\begin{frame}[fragile]
The first line here does this; it is easy to deal with this: the function read.csv takes the optional argument skip=, which indicates how many lines to skip at the beginning
The second line is also empty, so let us skip it too

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{data_old} \hlkwb{=} \hlkwd{read.csv}\hldef{(}\hlsng{"https://www150.statcan.gc.ca/n1/en/pub/11-516-x/sectiona/A2_14-eng.csv?st=L7vSnqio"}\hldef{,}
                    \hlkwc{skip} \hldef{=} \hlnum{2}\hldef{)}
\hlkwd{head}\hldef{(data_old)}
\end{alltt}
\begin{verbatim}
##    X Year     Canada X.1 Newfound.  Prince X.2    Nova       New    Quebec
## 1 NA                  NA      land  Edward  NA  Scotia Brunswick          
## 2 NA                  NA            Island  NA                            
## 3 NA               2  NA         3       4  NA       5         6         7
## 4 NA                  NA                    NA                            
## 5 NA 1976 22,992,604  NA   557,725 118,229  NA 828,571   677,250 6,234,445
## 6 NA                  NA                    NA                            
##     Ontario  Manitoba X.3 Saskat. X.4   Alberta X.5   British X.6     Yukon
## 1                      NA  chewan  NA            NA  Columbia  NA Territory
## 2                      NA          NA            NA            NA          
## 3         8         9  NA      10  NA        11  NA        12  NA        13
## 4                      NA          NA            NA            NA          
## 5 8,264,465 1,021,506  NA 921,323  NA 1,838,037  NA 2,466,608  NA    21,836
## 6                      NA          NA            NA            NA          
##     Northwest X.7 X.8
## 1 Territories  NA  NA
## 2              NA  NA
## 3          14  NA  NA
## 4              NA  NA
## 5      42,609  NA  NA
## 6              NA  NA
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
Here, there is the further issue that to make things legible, the table authors used 3 rows (from 2 to 4) to encode for long names (e.g., Prince Edward Island is written over 3 rows). Note, however, that `read.csv` has rightly picked up on the first row being the column names.

(You could also use the function `read\_csv` from the package `readr` to read in the file. This function is a bit more flexible than `read.csv` and can handle such cases more easily. However, it is not part of the base R package, so you would need to install it first.)

Because we are only interested in the total population of the country and the year, let us simply get rid of the first 4 rows and of all columns except the second (Year) and third (Canada)

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{data_old} \hlkwb{=} \hldef{data_old[}\hlnum{5}\hlopt{:}\hlkwd{dim}\hldef{(data_old)[}\hlnum{1}\hldef{],} \hlnum{2}\hlopt{:}\hlnum{3}\hldef{]}
\hlkwd{head}\hldef{(data_old,} \hlkwc{n}\hldef{=}\hlnum{4}\hldef{)}
\end{alltt}
\begin{verbatim}
##   Year     Canada
## 5 1976 22,992,604
## 6                
## 7 1971 21,568,311
## 8 1966 20,014,880
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}
Still not perfect:

- there are some empty rows;
- the last few rows need to be removed too, they contain remarks about the data;
- the population counts contain commas;
- it would be better if years were increasing.

Let us fix these issues.

For 1 and 2, this is easy: remark that the Canada column is empty for both issues. Now remark as well that below Canada (and Year, for that matter), it is written \code{<chr>}. This means that entries in the column are characters. Looking for empty content therefore means looking for empty character chains.

So to fix 1 and 2, we keep the rows where Canada does not equal the empty chain.

To get rid of commas, we just need to substitute an empty chain for ",".

To sort, we find the order for the years and apply it to the entire table.

Finally, as remarked above, for now, both the year and the population are considered as character chains. This means that in order to plot anything, we will have to indicate that these are numbers, not characters.
\end{frame}

\begin{frame}[fragile]

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{data_old} \hlkwb{=} \hldef{data_old[}\hlkwd{which}\hldef{(data_old}\hlopt{$}\hldef{Canada} \hlopt{!=} \hlsng{""}\hldef{),]}
\hldef{data_old}\hlopt{$}\hldef{Canada} \hlkwb{=} \hlkwd{gsub}\hldef{(}\hlsng{","}\hldef{,} \hlsng{""}\hldef{, data_old}\hlopt{$}\hldef{Canada)}
\hldef{order_data} \hlkwb{=} \hlkwd{order}\hldef{(data_old}\hlopt{$}\hldef{Year)}
\hldef{data_old} \hlkwb{=} \hldef{data_old[order_data,]}
\hldef{data_old}\hlopt{$}\hldef{Year} \hlkwb{=} \hlkwd{as.numeric}\hldef{(data_old}\hlopt{$}\hldef{Year)}
\hldef{data_old}\hlopt{$}\hldef{Canada} \hlkwb{=} \hlkwd{as.numeric}\hldef{(data_old}\hlopt{$}\hldef{Canada)}
\hldef{data_old}
\end{alltt}
\begin{verbatim}
##    Year   Canada
## 23 1851  2436297
## 22 1861  3229633
## 21 1871  3689257
## 20 1881  4324810
## 19 1891  4833239
## 17 1901  5371315
## 16 1911  7206643
## 15 1921  8787949
## 14 1931 10376786
## 13 1941 11506655
## 11 1951 14009429
## 10 1956 16080791
## 9  1961 18238247
## 8  1966 20014880
## 7  1971 21568311
## 5  1976 22992604
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}


\begin{frame}[fragile]
Row numbers are a little weird, so let us fix this.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{row.names}\hldef{(data_old)} \hlkwb{=} \hlnum{1}\hlopt{:}\hlkwd{dim}\hldef{(data_old)[}\hlnum{1}\hldef{]}
\hldef{data_old}
\end{alltt}
\begin{verbatim}
##    Year   Canada
## 1  1851  2436297
## 2  1861  3229633
## 3  1871  3689257
## 4  1881  4324810
## 5  1891  4833239
## 6  1901  5371315
## 7  1911  7206643
## 8  1921  8787949
## 9  1931 10376786
## 10 1941 11506655
## 11 1951 14009429
## 12 1956 16080791
## 13 1961 18238247
## 14 1966 20014880
## 15 1971 21568311
## 16 1976 22992604
\end{verbatim}
\end{kframe}
\end{knitrout}

Well, that looks about right! Let's see what this looks like in a graph.
\end{frame}

\begin{frame}[fragile]
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hldef{(data_old}\hlopt{$}\hldef{Year, data_old}\hlopt{$}\hldef{Canada,}
    \hlkwc{type} \hldef{=} \hlsng{"b"}\hldef{,} \hlkwc{lwd} \hldef{=} \hlnum{2}\hldef{,}
    \hlkwc{xlab} \hldef{=} \hlsng{"Year"}\hldef{,} \hlkwc{ylab} \hldef{=} \hlsng{"Population"}\hldef{)}
\end{alltt}
\end{kframe}
\includegraphics[width=\maxwidth]{FIGS/L05-plot-old-Canada-census-data-1} 
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
But wait, this is only to 1976..! Looking around, we find another table here. There's a download csv link in there, let us see where this leads us. The table is 720KB, so surely there must be more to this than just the population. To get a sense of that, we dump the whole data.frame, not just its head.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{data_new} \hlkwb{=} \hlkwd{read.csv}\hldef{(}\hlsng{"https://www12.statcan.gc.ca/census-recensement/2011/dp-pd/vc-rv/download-telecharger/download-telecharger.cfm?Lang=eng&CTLG=98-315-XWE2011001&FMT=csv"}\hldef{)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in file(file, "{}rt"{}): cannot open the connection to 'https://www12.statcan.gc.ca/census-recensement/2011/dp-pd/vc-rv/download-telecharger/download-telecharger.cfm?Lang=eng\&CTLG=98-315-XWE2011001\&FMT=csv'}}\begin{alltt}
\hlkwd{head}\hldef{(data_new,} \hlnum{10}\hldef{)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'head': object 'data\_new' not found}}\end{kframe}
\end{knitrout}































